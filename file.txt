version 3.1 with sort_function
